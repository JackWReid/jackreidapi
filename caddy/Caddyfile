{
  email hello@jackreid.xyz
}

jackreid.xyz {
  encode gzip

  file_server * {
    root /usr/share/caddy/site
  }

  log {
    output file /etc/caddy/logs/server_log
  }

  handle_errors {
    @404 {
      expression {http.error.status_code} == 404
    }
    rewrite @404 /404.html
    file_server
  }
}

api.jackreid.xyz {
  encode gzip

  reverse_proxy * http://api:3000 {
    health_path /health
    health_interval 5m
  }

  tls /etc/caddy/certs/cert.pem /etc/caddy/certs/privkey.pem {
    #ca https://acme-staging-v02.api.letsencrypt.org/directory
  }

  log {
    output file /etc/caddy/logs/server_log
  }
}
